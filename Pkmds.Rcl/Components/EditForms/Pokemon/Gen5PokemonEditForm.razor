@inherits BaseEditForm

@if (AppState.SelectedPokemon is not null)
{
    <MudTabs>
        <MudTabPanel Text="Main">

            <MudNumericField Label="PID"
                             Variant="@Variant.Outlined"
                             @bind-Value="AppState.SelectedPokemon.PID"
                             For="@(() => AppState.SelectedPokemon.PID)" />

            <MudAutocomplete Label="Species"
                             Variant="@Variant.Outlined"
                             @bind-Value="@AppState.SelectedPokemon.Species"
                             @bind-Value:after="@(() => { AppState.LoadPokemonStats(); AppState.Refresh(); })"
                             SearchFunc="@(async (searchString) => await AppState.SearchPokemonNames(EntityContext.Gen5, searchString))"
                             ToStringFunc="@AppState.ConvertSpeciesToName"
                             For="@(() => AppState.SelectedPokemon.Species)" />

            <MudTextField Label="Nickname"
                          Variant="@Variant.Outlined"
                          @bind-Value="@AppState.SelectedPokemon.Nickname"
                          For="@(() => AppState.SelectedPokemon.Nickname)" />

            <MudNumericField Label="EXP"
                             Variant="@Variant.Outlined"
                             @bind-Value="@AppState.SelectedPokemon.EXP"
                             For="@(() => AppState.SelectedPokemon.EXP)" />

            <MudNumericField Label="Level"
                             Variant="@Variant.Outlined"
                             @bind-Value="@AppState.SelectedPokemon.CurrentLevel"
                             @bind-Value:after="@(AppState.LoadPokemonStats)"
                             For="@(() => AppState.SelectedPokemon.CurrentLevel)" />

            <MudSelect Label="Nature"
                       Variant="@Variant.Outlined"
                       @bind-Value="@AppState.SelectedPokemon.Nature"
                       @bind-Value:after="@(AppState.LoadPokemonStats)"
                       For="@(() => AppState.SelectedPokemon.Nature)">
                @foreach (Nature nature in Enum.GetValues(typeof(Nature)))
                {
                    if (nature == Nature.Random)
                    {
                        continue;
                    }
                    <MudSelectItem Value="@((int)nature)">
                        <MudStack>
                            <MudText>
                                @(nature.ToString())
                            </MudText>
                            @{
                                var str = AppState.GetStatModifierString((int)nature);
                            }
                            @if (str is { Length: > 0 })
                            {
                                <MudText>
                                    @str
                                </MudText>
                            }
                        </MudStack>
                    </MudSelectItem>
                }
            </MudSelect>

            <MudAutocomplete Label="Held Item"
                             Variant="@Variant.Outlined"
                             @bind-Value="@AppState.SelectedPokemon.HeldItem"
                             @bind-Value:after="@(AppState.Refresh)"
                             For="@(() => AppState.SelectedPokemon.HeldItem)" />

            <MudAutocomplete Label="Ability"
                             Variant="@Variant.Outlined"
                             @bind-Value="@AppState.SelectedPokemon.Ability"
                             @bind-Value:after="@(AppState.Refresh)"
                             For="@(() => AppState.SelectedPokemon.Ability)" />

            <MudAutocomplete Label="Language"
                             Variant="@Variant.Outlined"
                             @bind-Value="@AppState.SelectedPokemon.Language"
                             @bind-Value:after="@(AppState.Refresh)"
                             For="@(() => AppState.SelectedPokemon.Language)" />

            @*
            <MudAutocomplete Label="Held Item"
                             Variant="@Variant.Outlined"
                             @bind-Value="@AppState.SelectedPokemon.HeldItem"
                             @bind-Value:after="@(AppState.Refresh)"
                             SearchFunc="@(async (searchString) => await AppState.SearchItemNames(EntityContext.Gen5, searchString))"
                             ToStringFunc="@AppState.ConvertItemToName"
                             For="@(() => AppState.SelectedPokemon.HeldItem)" />

            <MudAutocomplete Label="Ability"
                             Variant="@Variant.Outlined"
                             @bind-Value="@AppState.SelectedPokemon.Ability"
                             @bind-Value:after="@(AppState.Refresh)"
                             SearchFunc="@(async (searchString) => await AppState.SearchAbilityNames(EntityContext.Gen5, searchString))"
                             ToStringFunc="@AppState.ConvertAbilityToName"
                             For="@(() => AppState.SelectedPokemon.Ability)" />

            <MudAutocomplete Label="Language"
                             Variant="@Variant.Outlined"
                             @bind-Value="@AppState.SelectedPokemon.Language"
                             @bind-Value:after="@(AppState.Refresh)"
                             SearchFunc="@(async (searchString) => await AppState.SearchLanguageNames(EntityContext.Gen5, searchString))"
                             ToStringFunc="@AppState.ConvertLanguageToName"
                             For="@(() => AppState.SelectedPokemon.Language)" />
        *@

            <MudNumericField Label="Friendship"
                             Variant="@Variant.Outlined"
                             Min="0"
                             Max="255"
                             @bind-Value="@AppState.SelectedPokemon.CurrentFriendship"
                             For="@(() => AppState.SelectedPokemon.CurrentFriendship)" />

            <MudCheckBox Label="Is Egg"
                         @bind-Checked="@AppState.SelectedPokemon.IsEgg"
                         @bind-Checked:after="@AppState.Refresh"
                         For="@(() => AppState.SelectedPokemon.IsEgg)" />

            <MudCheckBox Label="Infected"
                         @bind-Checked="@AppState.SelectedPokemon.PKRS_Infected"
                         @bind-Checked:after="@AppState.Refresh"
                         For="@(() => AppState.SelectedPokemon.PKRS_Infected)" />

            <MudCheckBox Label="Cured"
                         @bind-Checked="@AppState.SelectedPokemon.PKRS_Cured"
                         @bind-Checked:after="@AppState.Refresh"
                         For="@(() => AppState.SelectedPokemon.PKRS_Cured)" />
            @*
            <MudCheckBox Label="N's Sparkle"
                         @bind-Checked="@AppState.SelectedPokemon"
                         @bind-Checked:after="@AppState.Refresh"
                         For="@(() => AppState.SelectedPokemon.PKRS_Cured)"/>
        *@

            <MudCheckBox Label="Shiny"
                         Checked="@AppState.SelectedPokemon.IsShiny"
                         ReadOnly="@true"
                         For="@(() => AppState.SelectedPokemon.IsShiny)" />

        </MudTabPanel>

        <MudTabPanel Text="Met">

            <MudCheckBox Label="Nicknamed"
                         @bind-Checked="@AppState.SelectedPokemon.IsNicknamed"
                         @bind-Checked:after="@AppState.Refresh"
                         For="@(() => AppState.SelectedPokemon.IsNicknamed)" />

            <MudSelect Label="Origin Game"
                       Variant="@Variant.Outlined"
                       @bind-Value="@AppState.SelectedPokemon.Version"
                       ToStringFunc="@((version) => GameInfo.GetVersionName((GameVersion)version))"
                       For="@(() => AppState.SelectedPokemon.Version)">
                @foreach (GameVersion version in Enum.GetValues(typeof(GameVersion)))
                {
                    <MudSelectItem Value="@((int)(byte)version)" />
                }
            </MudSelect>

            <MudAutocomplete Label="Met Location"
                             Variant="@Variant.Outlined"
                             @bind-Value="@AppState.SelectedPokemon.Met_Location"
                             For="@(() => AppState.SelectedPokemon.Language)" />
            @*
                             SearchFunc="@(async (searchString) => await AppState.SearchLanguageNames(EntityContext.Gen5, searchString))"
                             ToStringFunc="@AppState.ConvertLanguageToName"
        *@

            <MudSelect Label="Ball"
                       Variant="@Variant.Outlined"
                       @bind-Value="@AppState.SelectedPokemon.Ball"
                       For="@(() => AppState.SelectedPokemon.Ball)">
                @foreach (ComboItem ball in GameInfo.BallDataSource)
                {
                    <MudSelectItem Value="@ball.Value">
                        <MudStack Row="@true">
                            <MudImage Src="@SpriteHelper.GetBallSpriteFilename(ball.Value)"
                                      Width="20"
                                      Height="20"/>
                            <MudText>
                                @ball.Text
                            </MudText>
                        </MudStack>
                    </MudSelectItem>
                }
            </MudSelect>

            <MudPaper Elevation="0"
                      Outlined="@true"
                      Class="my-2">
                <MudStack>
                    <MudInputLabel ForId="metDate">
                        Met Date
                    </MudInputLabel>
                    <InputDate @bind-Value="@AppState.SelectedPokemon.MetDate"
                               id="metDate"
                               DisplayName="Met Date" />
                </MudStack>
            </MudPaper>

        @*
            <MudCheckBox Label="Met as Egg"
                         @bind-Checked="@AppState.SelectedPokemon.WasEgg"
                         @bind-Checked:after="@AppState.Refresh"
                         For="@(() => AppState.SelectedPokemon.WasEgg)" />
        *@
            <MudAutocomplete Label="Egg Location"
                             Variant="@Variant.Outlined"
                             @bind-Value="@AppState.SelectedPokemon.Egg_Location"
                             For="@(() => AppState.SelectedPokemon.Language)" />
            @*
                             SearchFunc="@(async (searchString) => await AppState.SearchLanguageNames(EntityContext.Gen5, searchString))"
                             ToStringFunc="@AppState.ConvertLanguageToName"
        *@

            <MudPaper Elevation="0"
                      Outlined="@true"
                      Class="my-2">
                <MudStack>
                    <MudInputLabel ForId="eggDate">
                        Egg Date
                    </MudInputLabel>
                    <InputDate @bind-Value="@AppState.SelectedPokemon.EggMetDate"
                               id="eggDate"
                               DisplayName="Egg Date" />
                </MudStack>
            </MudPaper>

        </MudTabPanel>

        <MudTabPanel Text="Stats">

            <MudGrid>

                <MudItem xs="3">
                    <MudStack>
                        <MudNumericField Label="Base HP"
                                         Variant="@Variant.Outlined"
                                         Value="@AppState.SelectedPokemon.PersonalInfo.HP"
                                         For="@(() => AppState.SelectedPokemon.IV_HP)"
                                         ReadOnly="@true" />

                        <MudNumericField Label="Base Attack"
                                         Variant="@Variant.Outlined"
                                         Value="@AppState.SelectedPokemon.PersonalInfo.ATK"
                                         For="@(() => AppState.SelectedPokemon.IV_ATK)"
                                         ReadOnly="@true" />

                        <MudNumericField Label="Base Defense"
                                         Variant="@Variant.Outlined"
                                         Value="@AppState.SelectedPokemon.PersonalInfo.DEF"
                                         For="@(() => AppState.SelectedPokemon.IV_DEF)"
                                         ReadOnly="@true" />

                        <MudNumericField Label="Base Sp. Attack"
                                         Variant="@Variant.Outlined"
                                         Value="@AppState.SelectedPokemon.PersonalInfo.SPA"
                                         For="@(() => AppState.SelectedPokemon.IV_SPA)"
                                         ReadOnly="@true" />

                        <MudNumericField Label="Base Sp. Defense"
                                         Variant="@Variant.Outlined"
                                         Value="@AppState.SelectedPokemon.PersonalInfo.SPD"
                                         For="@(() => AppState.SelectedPokemon.IV_SPD)"
                                         ReadOnly="@true" />

                        <MudNumericField Label="Base Speed"
                                         Variant="@Variant.Outlined"
                                         Value="@AppState.SelectedPokemon.PersonalInfo.SPE"
                                         For="@(() => AppState.SelectedPokemon.IV_SPE)"
                                         ReadOnly="@true" />
                    </MudStack>
                </MudItem>

                <MudItem xs="3">
                    <MudStack>
                        <MudNumericField Label="HP IV"
                                         Variant="@Variant.Outlined"
                                         Min="0"
                                         Max="31"
                                         @bind-Value="@AppState.SelectedPokemon.IV_HP"
                                         @bind-Value:after="@(AppState.LoadPokemonStats)"
                                         For="@(() => AppState.SelectedPokemon.IV_HP)" />

                        <MudNumericField Label="Attack IV"
                                         Variant="@Variant.Outlined"
                                         Min="0"
                                         Max="31"
                                         @bind-Value="@AppState.SelectedPokemon.IV_ATK"
                                         @bind-Value:after="@(AppState.LoadPokemonStats)"
                                         For="@(() => AppState.SelectedPokemon.IV_ATK)" />

                        <MudNumericField Label="Defense IV"
                                         Variant="@Variant.Outlined"
                                         Min="0"
                                         Max="31"
                                         @bind-Value="@AppState.SelectedPokemon.IV_DEF"
                                         @bind-Value:after="@(AppState.LoadPokemonStats)"
                                         For="@(() => AppState.SelectedPokemon.IV_DEF)" />

                        <MudNumericField Label="Sp. Attack IV"
                                         Variant="@Variant.Outlined"
                                         Min="0"
                                         Max="31"
                                         @bind-Value="@AppState.SelectedPokemon.IV_SPA"
                                         @bind-Value:after="@(AppState.LoadPokemonStats)"
                                         For="@(() => AppState.SelectedPokemon.IV_SPA)" />

                        <MudNumericField Label="Sp. Defense IV"
                                         Variant="@Variant.Outlined"
                                         Min="0"
                                         Max="31"
                                         @bind-Value="@AppState.SelectedPokemon.IV_SPD"
                                         @bind-Value:after="@(AppState.LoadPokemonStats)"
                                         For="@(() => AppState.SelectedPokemon.IV_SPD)" />

                        <MudNumericField Label="Speed IV"
                                         Variant="@Variant.Outlined"
                                         Min="0"
                                         Max="31"
                                         @bind-Value="@AppState.SelectedPokemon.IV_SPE"
                                         @bind-Value:after="@(AppState.LoadPokemonStats)"
                                         For="@(() => AppState.SelectedPokemon.IV_SPE)" />
                    </MudStack>
                </MudItem>

                <MudItem xs="3">
                    <MudStack>
                        <MudNumericField Label="HP EV"
                                         Variant="@Variant.Outlined"
                                         Min="0"
                                         Max="255"
                                         @bind-Value="@AppState.SelectedPokemon.EV_HP"
                                         @bind-Value:after="@(AppState.LoadPokemonStats)"
                                         For="@(() => AppState.SelectedPokemon.EV_HP)" />

                        <MudNumericField Label="Attack EV"
                                         Variant="@Variant.Outlined"
                                         Min="0"
                                         Max="255"
                                         @bind-Value="@AppState.SelectedPokemon.EV_ATK"
                                         @bind-Value:after="@(AppState.LoadPokemonStats)"
                                         For="@(() => AppState.SelectedPokemon.EV_ATK)" />

                        <MudNumericField Label="Defense EV"
                                         Variant="@Variant.Outlined"
                                         Min="0"
                                         Max="255"
                                         @bind-Value="@AppState.SelectedPokemon.EV_DEF"
                                         @bind-Value:after="@(AppState.LoadPokemonStats)"
                                         For="@(() => AppState.SelectedPokemon.EV_DEF)" />

                        <MudNumericField Label="Sp. Attack EV"
                                         Variant="@Variant.Outlined"
                                         Min="0"
                                         Max="255"
                                         @bind-Value="@AppState.SelectedPokemon.EV_SPA"
                                         @bind-Value:after="@(AppState.LoadPokemonStats)"
                                         For="@(() => AppState.SelectedPokemon.EV_SPA)" />

                        <MudNumericField Label="Sp. Defense EV"
                                         Variant="@Variant.Outlined"
                                         Min="0"
                                         Max="255"
                                         @bind-Value="@AppState.SelectedPokemon.EV_SPD"
                                         @bind-Value:after="@(AppState.LoadPokemonStats)"
                                         For="@(() => AppState.SelectedPokemon.EV_SPD)" />

                        <MudNumericField Label="Speed EV"
                                         Variant="@Variant.Outlined"
                                         Min="0"
                                         Max="255"
                                         @bind-Value="@AppState.SelectedPokemon.EV_SPE"
                                         @bind-Value:after="@(AppState.LoadPokemonStats)"
                                         For="@(() => AppState.SelectedPokemon.EV_SPE)" />
                    </MudStack>
                </MudItem>

                <MudItem xs="3">
                    <MudStack>
                        <MudNumericField Label="HP"
                                         Variant="@Variant.Outlined"
                                         Value="@AppState.SelectedPokemon.Stat_HPMax"
                                         For="@(() => AppState.SelectedPokemon.IV_HP)"
                                         ReadOnly="@true" />

                        <MudNumericField Label="Attack"
                                         Variant="@Variant.Outlined"
                                         Value="@AppState.SelectedPokemon.Stat_ATK"
                                         For="@(() => AppState.SelectedPokemon.IV_ATK)"
                                         ReadOnly="@true" />

                        <MudNumericField Label="Defense"
                                         Variant="@Variant.Outlined"
                                         Value="@AppState.SelectedPokemon.Stat_DEF"
                                         For="@(() => AppState.SelectedPokemon.IV_DEF)"
                                         ReadOnly="@true" />

                        <MudNumericField Label="Sp. Attack"
                                         Variant="@Variant.Outlined"
                                         Value="@AppState.SelectedPokemon.Stat_SPA"
                                         For="@(() => AppState.SelectedPokemon.IV_SPA)"
                                         ReadOnly="@true" />

                        <MudNumericField Label="Sp. Defense"
                                         Variant="@Variant.Outlined"
                                         Value="@AppState.SelectedPokemon.Stat_SPD"
                                         For="@(() => AppState.SelectedPokemon.IV_SPD)"
                                         ReadOnly="@true" />

                        <MudNumericField Label="Speed"
                                         Variant="@Variant.Outlined"
                                         Value="@AppState.SelectedPokemon.Stat_SPE"
                                         For="@(() => AppState.SelectedPokemon.IV_SPE)"
                                         ReadOnly="@true" />
                    </MudStack>
                </MudItem>

            </MudGrid>

        </MudTabPanel>
    </MudTabs>
}

@code {
    //var metLocations = GameInfo.GetLocationList(GameVers, context, egg: false);
}
