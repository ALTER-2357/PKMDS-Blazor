@inherits BasePkmdsComponent

@if (Pokemon is not null &&
AppState.SaveFile is { Context: { } saveFileEntityContext, Generation: { } saveGeneration } &&
saveFileEntityContext is not
EntityContext.None or
EntityContext.SplitInvalid or
EntityContext.MaxInvalid &&
AppState.SelectedSlotsAreValid)
{
    <MudNumericField Label="Level"
                     Variant="@Variant.Outlined"
                     @bind-Value="@Pokemon.CurrentLevel"
                     @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                     For="@(() => Pokemon.CurrentLevel)" />

    @if (Pokemon is ICombatPower pb)
    {
        <MudNumericField Label="CP"
                         Variant="@Variant.Outlined"
                         ReadOnly
                         HideSpinButtons
                         Value="@pb.Stat_CP"
                         For="@(() => pb.Stat_CP)"/>
    }

    @if (saveGeneration > 2)
    {
        <MudSelect Label="Nature"
                   Variant="@Variant.Outlined"
                   @bind-Value:get="@Pokemon.Nature"
                   @bind-Value:set="@OnNatureSet"
                   For="@(() => Pokemon.Nature)">
            @foreach (var nature in GameInfo.FilteredSources.Natures.DistinctBy(nature => nature.Value))
            {
                <MudSelectItem Value="@((Nature)nature.Value)"
                               @key="@nature.Value">
                    <MudStack>
                        <MudText>
                            @nature.Text
                        </MudText>
                        @{
                        var str = AppService.GetStatModifierString((Nature)nature.Value);
                    }
                    @if (str is { Length: > 0 })
                    {
                        <MudText>
                            @str
                        </MudText>
                    }
                </MudStack>
            </MudSelectItem>
            }
        </MudSelect>
    }

    <MudGrid>

        <MudItem xs="3">
            <MudStack>
                <MudText>
                    Base
                </MudText>

                <MudNumericField Label="HP"
                                 Variant="@Variant.Outlined"
                                 Value="@Pokemon.PersonalInfo.HP"
                                 ReadOnly
                                 HideSpinButtons />

                <MudNumericField Label="Attack"
                                 Variant="@Variant.Outlined"
                                 Value="@Pokemon.PersonalInfo.ATK"
                                 ReadOnly
                                 HideSpinButtons />

                <MudNumericField Label="Defense"
                                 Variant="@Variant.Outlined"
                                 Value="@Pokemon.PersonalInfo.DEF"
                                 ReadOnly
                                 HideSpinButtons />

                @if (saveGeneration == 1 && Pokemon is PK1 pk1)
                {
                    <MudNumericField Label="Speed"
                                     Variant="@Variant.Outlined"
                                     Value="@pk1.PersonalInfo.SPE"
                                     ReadOnly
                                     HideSpinButtons />

                    <MudNumericField Label="Special"
                                     Variant="@Variant.Outlined"
                                     Value="@pk1.PersonalInfo.SPC"
                                     ReadOnly
                                     HideSpinButtons />
                }
                else
                {
                    <MudNumericField Label="Sp. Atk"
                                     Variant="@Variant.Outlined"
                                     Value="@Pokemon.PersonalInfo.SPA"
                                     ReadOnly
                                     HideSpinButtons />

                    <MudNumericField Label="Sp. Def"
                                     Variant="@Variant.Outlined"
                                     Value="@Pokemon.PersonalInfo.SPD"
                                     ReadOnly
                                     HideSpinButtons />

                    <MudNumericField Label="Speed"
                                     Variant="@Variant.Outlined"
                                     Value="@Pokemon.PersonalInfo.SPE"
                                     ReadOnly
                                     HideSpinButtons />

                    <MudNumericField Label="Total"
                                     Variant="@Variant.Outlined"
                                     Value="@Pokemon.PersonalInfo.GetBaseStatTotal()"
                                     ReadOnly
                                     HideSpinButtons />
                }

            </MudStack>
        </MudItem>

        <MudItem xs="3">
            <MudStack>
                <MudText>
                    IVs
                </MudText>

                <MudNumericField Label="HP"
                                 Variant="@Variant.Outlined"
                                 Min="0"
                                 Max="31"
                                 @bind-Value="@Pokemon.IV_HP"
                                 @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                 For="@(() => Pokemon.IV_HP)"
                                 ReadOnly="@(saveGeneration == 1 && Pokemon is PK1)"
                                 HideSpinButtons="@(saveGeneration == 1 && Pokemon is PK1)" />

                <MudNumericField Label="Attack"
                                 Variant="@Variant.Outlined"
                                 Min="0"
                                 Max="31"
                                 @bind-Value="@Pokemon.IV_ATK"
                                 @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                 For="@(() => Pokemon.IV_ATK)" />

                <MudNumericField Label="Defense"
                                 Variant="@Variant.Outlined"
                                 Min="0"
                                 Max="31"
                                 @bind-Value="@Pokemon.IV_DEF"
                                 @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                 For="@(() => Pokemon.IV_DEF)" />


                @if (saveGeneration == 1 && Pokemon is PK1 pk1)
                {
                    <MudNumericField Label="Speed"
                                     Variant="@Variant.Outlined"
                                     @bind-Value="@pk1.IV_SPE"
                                     @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                     For="@(() => pk1.IV_SPE)" />

                    <MudNumericField Label="Special"
                                     Variant="@Variant.Outlined"
                                     @bind-Value="@pk1.IV_SPC"
                                     @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                     For="@(() => pk1.IV_SPC)" />
                }
                else
                {
                    <MudNumericField Label="Sp. Atk"
                                     Variant="@Variant.Outlined"
                                     Min="0"
                                     Max="31"
                                     @bind-Value="@Pokemon.IV_SPA"
                                     @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                     For="@(() => Pokemon.IV_SPA)" />

                    <MudNumericField Label="Sp. Def"
                                     Variant="@Variant.Outlined"
                                     Min="0"
                                     Max="31"
                                     @bind-Value="@Pokemon.IV_SPD"
                                     @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                     For="@(() => Pokemon.IV_SPD)" />

                    <MudNumericField Label="Speed"
                                     Variant="@Variant.Outlined"
                                     Min="0"
                                     Max="31"
                                     @bind-Value="@Pokemon.IV_SPE"
                                     @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                     For="@(() => Pokemon.IV_SPE)" />

                    <MudNumericField Label="Total"
                                     Variant="@Variant.Outlined"
                                     Value="@Pokemon.IVTotal"
                                     For="@(() => Pokemon.IVTotal)"
                                     ReadOnly />
                }

            </MudStack>
        </MudItem>

        @if (Pokemon is IAwakened aPkm)
        {
            <MudItem xs="3">
                <MudStack>
                    <MudText>
                        AVs
                    </MudText>

                    <MudNumericField Label="HP"
                                     T="@byte"
                                     Variant="@Variant.Outlined"
                                     Min="0"
                                     Max="@AwakeningUtil.AwakeningMax"
                                     @bind-Value="@aPkm.AV_HP"
                                     @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                     For="@(() => aPkm.AV_HP)" />

                    <MudNumericField Label="Attack"
                                     T="@byte"
                                     Variant="@Variant.Outlined"
                                     Min="0"
                                     Max="@AwakeningUtil.AwakeningMax"
                                     @bind-Value="@aPkm.AV_ATK"
                                     @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                     For="@(() => aPkm.AV_ATK)" />

                    <MudNumericField Label="Defense"
                                     T="@byte"
                                     Variant="@Variant.Outlined"
                                     Min="0"
                                     Max="@AwakeningUtil.AwakeningMax"
                                     @bind-Value="@aPkm.AV_DEF"
                                     @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                     For="@(() => aPkm.AV_DEF)" />

                    <MudNumericField Label="Sp. Atk"
                                     T="@byte"
                                     Variant="@Variant.Outlined"
                                     Min="0"
                                     Max="@AwakeningUtil.AwakeningMax"
                                     @bind-Value="@aPkm.AV_SPA"
                                     @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                     For="@(() => aPkm.AV_SPA)" />

                    <MudNumericField Label="Sp. Def"
                                     T="@byte"
                                     Variant="@Variant.Outlined"
                                     Min="0"
                                     Max="@AwakeningUtil.AwakeningMax"
                                     @bind-Value="@aPkm.AV_SPD"
                                     @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                     For="@(() => aPkm.AV_SPD)" />

                    <MudNumericField Label="Speed"
                                     T="@byte"
                                     Variant="@Variant.Outlined"
                                     Min="0"
                                     Max="@AwakeningUtil.AwakeningMax"
                                     @bind-Value="@aPkm.AV_SPE"
                                     @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                     For="@(() => aPkm.AV_SPE)" />

                    <MudNumericField Label="Total"
                                     Variant="@Variant.Outlined"
                                     Value="@aPkm.AwakeningSum()"
                                     ReadOnly />

                </MudStack>
            </MudItem>
        }
        else
        {
            <MudItem xs="3">
                <MudStack>
                    <MudText>
                        EVs
                    </MudText>

                    <MudNumericField Label="HP"
                                     Variant="@Variant.Outlined"
                                     Min="0"
                                     Max="@GetEvMax(saveGeneration)"
                                     @bind-Value="@Pokemon.EV_HP"
                                     @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                     For="@(() => Pokemon.EV_HP)" />

                    <MudNumericField Label="Attack"
                                     Variant="@Variant.Outlined"
                                     Min="0"
                                     Max="@GetEvMax(saveGeneration)"
                                     @bind-Value="@Pokemon.EV_ATK"
                                     @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                     For="@(() => Pokemon.EV_ATK)" />

                    <MudNumericField Label="Defense"
                                     Variant="@Variant.Outlined"
                                     Min="0"
                                     Max="@GetEvMax(saveGeneration)"
                                     @bind-Value="@Pokemon.EV_DEF"
                                     @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                     For="@(() => Pokemon.EV_DEF)" />

                    @if (saveGeneration == 1 && Pokemon is PK1 pk1)
                    {
                        <MudNumericField Label="Speed"
                                         Variant="@Variant.Outlined"
                                         @bind-Value="@pk1.EV_SPE"
                                         @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                         For="@(() => pk1.EV_SPE)" />

                        <MudNumericField Label="Special"
                                         Variant="@Variant.Outlined"
                                         @bind-Value="@pk1.EV_SPC"
                                         @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                         For="@(() => pk1.EV_SPC)" />
                    }
                    else
                    {
                        <MudNumericField Label="Sp. Atk"
                                         Variant="@Variant.Outlined"
                                         Min="0"
                                         Max="@GetEvMax(saveGeneration)"
                                         @bind-Value="@Pokemon.EV_SPA"
                                         @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                         For="@(() => Pokemon.EV_SPA)" />

                        <MudNumericField Label="Sp. Def"
                                         Variant="@Variant.Outlined"
                                         Min="0"
                                         Max="@GetEvMax(saveGeneration)"
                                         @bind-Value="@Pokemon.EV_SPD"
                                         @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                         For="@(() => Pokemon.EV_SPD)" />

                        <MudNumericField Label="Speed"
                                         Variant="@Variant.Outlined"
                                         Min="0"
                                         Max="@GetEvMax(saveGeneration)"
                                         @bind-Value="@Pokemon.EV_SPE"
                                         @bind-Value:after="@(() => AppService.LoadPokemonStats(Pokemon))"
                                         For="@(() => Pokemon.EV_SPE)" />

                        <MudNumericField Label="Total"
                                         Variant="@Variant.Outlined"
                                         Value="@Pokemon.EVTotal"
                                         ReadOnly />
                    }

                </MudStack>
            </MudItem>
        }
        <MudItem xs="3">
            <MudStack>
                <MudText>
                    Stats
                </MudText>

                <MudNumericField Label="HP"
                                 Variant="@Variant.Outlined"
                                 Value="@Pokemon.Stat_HPMax"
                                 ReadOnly
                                 HideSpinButtons />

                <MudNumericField Label="Attack"
                                 Variant="@Variant.Outlined"
                                 Value="@Pokemon.Stat_ATK"
                                 ReadOnly
                                 HideSpinButtons />

                <MudNumericField Label="Defense"
                                 Variant="@Variant.Outlined"
                                 Value="@Pokemon.Stat_DEF"
                                 ReadOnly
                                 HideSpinButtons />

                @if (saveGeneration == 1 && Pokemon is PK1 pk1)
                {
                    <MudNumericField Label="Speed"
                                     Variant="@Variant.Outlined"
                                     Value="@pk1.Stat_SPE"
                                     ReadOnly
                                     HideSpinButtons />

                    <MudNumericField Label="Special"
                                     Variant="@Variant.Outlined"
                                     Value="@pk1.Stat_SPC"
                                     ReadOnly
                                     HideSpinButtons />
                }
                else
                {
                    <MudNumericField Label="Sp. Atk"
                                     Variant="@Variant.Outlined"
                                     Value="@Pokemon.Stat_SPA"
                                     ReadOnly
                                     HideSpinButtons />

                    <MudNumericField Label="Sp. Def"
                                     Variant="@Variant.Outlined"
                                     Value="@Pokemon.Stat_SPD"
                                     ReadOnly
                                     HideSpinButtons />

                    <MudNumericField Label="Speed"
                                     Variant="@Variant.Outlined"
                                     Value="@Pokemon.Stat_SPE"
                                     ReadOnly
                                     HideSpinButtons />
                }

                <MudText>
                    <MudText>
                        @Pokemon.GetPotentialString()
                    </MudText>
                </MudText>

            </MudStack>
        </MudItem>

    </MudGrid>

    <MudStack Row
              AlignItems="@AlignItems.Center">
        <MudSelect Label="Hidden Power Type"
                   Variant="@Variant.Outlined"
                   @bind-Value:get="@Pokemon.HPType"
                   @bind-Value:set="@((int type) => Pokemon.SetHiddenPower(type))">
            @foreach (var type in Util.GetCBList(GameInfo.Strings.Types.ToArray().AsSpan(1, 16)).DistinctBy(type => type.Value))
            {
                <MudSelectItem Value="@type.Value"
                               @key="@type.Value">
                    @type.Text
                </MudSelectItem>
            }
        </MudSelect>
        <MudText>
            @Pokemon.HPPower
        </MudText>
    </MudStack>

    @if (saveGeneration > 3)
    {
        <MudText>
            Characteristic: @GetCharacteristic(Pokemon)
        </MudText>
    }
}
