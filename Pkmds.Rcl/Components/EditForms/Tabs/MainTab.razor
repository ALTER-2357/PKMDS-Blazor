@if (Pokemon is not null &&
AppState.SaveFile?.Context is EntityContext saveFileEntityContext &&
saveFileEntityContext is not
EntityContext.None or
EntityContext.SplitInvalid or
EntityContext.MaxInvalid &&
((AppState.SelectedBoxNumber is not null && AppState.SelectedBoxSlotNumber is not null) || (AppState.SelectedPartySlotNumber is not null)))
{
    <MudNumericField Label="PID"
                     Variant="@Variant.Outlined"
    @bind-Value="@Pokemon.PID"
    @bind-Value:after="@(() => { AppState.LoadPokemonStats(Pokemon); AppState.Refresh(); })"
                     For="@(() => Pokemon.PID)" />

    <MudAutocomplete T="ComboItem"
                     Label="Species"
                     Variant="@Variant.Outlined"
    @bind-Value:get="@(AppState.GetSpeciesComboItem(Pokemon.Species))"
    @bind-Value:set="@((species) => { Pokemon.Species = (ushort)species.Value; AppState.LoadPokemonStats(Pokemon); AppState.Refresh(); })"
                     SearchFunc="@((searchString) => Task.FromResult(AppState.SearchPokemonNames(searchString)))"
                     ToStringFunc="@((species) => species.Text)" />

    <MudCheckBox Label="Is Nicknamed"
    @bind-Checked="@Pokemon.IsNicknamed"
                 For="@(() => Pokemon.IsNicknamed)" />

    <MudTextField Label="Nickname"
                  Variant="@Variant.Outlined"
    @bind-Value="@Pokemon.Nickname"
                  For="@(() => Pokemon.Nickname)" />

    <MudNumericField Label="EXP"
                     Variant="@Variant.Outlined"
    @bind-Value="@Pokemon.EXP"
    @bind-Value:after="@(() => AppState.LoadPokemonStats(Pokemon))"
                     For="@(() => Pokemon.EXP)" />

    <MudNumericField Label="Level"
                     Variant="@Variant.Outlined"
    @bind-Value="@Pokemon.CurrentLevel"
    @bind-Value:after="@(() => AppState.LoadPokemonStats(Pokemon))"
                     For="@(() => Pokemon.CurrentLevel)" />

    <MudSelect Label="Nature"
               Variant="@Variant.Outlined"
    @bind-Value="@Pokemon.Nature"
    @bind-Value:after="@(() => AppState.LoadPokemonStats(Pokemon))"
               For="@(() => Pokemon.Nature)">
        @foreach (var nature in GameInfo.FilteredSources.Natures)
        {
            <MudSelectItem Value="@(nature.Value)">
                <MudStack>
                    <MudText>
                        @nature.Text
                    </MudText>
                    @{
                    var str = AppState.GetStatModifierString(nature.Value);
                }
                @if (str is { Length: > 0 })
                {
                    <MudText>
                        @str
                    </MudText>
                }
            </MudStack>
        </MudSelectItem>
        }
    </MudSelect>

    @if (Pokemon is { PersonalInfo.HasForms: true } || Pokemon is { Species: (ushort)Species.Unown })
    {
        var forms = FormConverter.GetFormList(Pokemon.Species, GameInfo.Strings.types, GameInfo.Strings.forms, GameInfo.GenderSymbolUnicode, Pokemon.Context);
        if (forms.AsEnumerable().Any(f => !string.IsNullOrEmpty(f)))
        {
            <MudSelect T="byte"
            @ref="@FormSelect"
                       Label="Forme"
                       Variant="@Variant.Outlined"
            @bind-Value="@Pokemon.Form"
            @bind-Value:after="@(() => { AppState.LoadPokemonStats(Pokemon); AppState.Refresh(); })"
                       For="@(() => Pokemon.Form)">
                @for (byte i = 0; i < forms.Length; i++)
                {
                    var formId = i;
                    <MudSelectItem Value="@formId">
                        @forms[formId]
                    </MudSelectItem>
                }
            </MudSelect>

            @if (Pokemon is IFormArgument f && FormArgumentUtil.GetFormArgumentMax(Pokemon.Species, Pokemon.Form, Pokemon.Context) > 0 && FormConverter.GetFormArgumentIsNamedIndex(Pokemon.Species))
            {
                <MudSelect T="uint?"
                           Label="Forme Arg"
                           Variant="@Variant.Outlined"
                @bind-Value:get="@(Pokemon.GetFormArgument())"
                @bind-Value:set="@((formArg) => { Pokemon.ChangeFormArgument(formArg ?? 0); AppState.LoadPokemonStats(Pokemon); AppState.Refresh(); })">
                    @{
                        var formArgs = FormConverter.GetFormArgumentStrings(Pokemon.Species);
                    }
                    @for (uint? i = 0; i < formArgs.Length; i++)
                    {
                        var formArg = i;
                        <MudSelectItem Value="@(formArg)">
                            @formArgs[formArg ?? 0]
                        </MudSelectItem>
                    }
                </MudSelect>
            }
        }
    }

    <MudAutocomplete T="ComboItem"
                     Label="Held Item"
                     Variant="@Variant.Outlined"
    @bind-Value:get="@(AppState.GetItemComboItem(Pokemon.HeldItem))"
    @bind-Value:set="@((item) => { Pokemon.HeldItem = item.Value; AppState.LoadPokemonStats(Pokemon); AppState.Refresh(); })"
                     SearchFunc="@((searchString) => Task.FromResult(AppState.SearchItemNames(searchString)))"
                     ToStringFunc="@((item) => item.Text)">
        <ItemTemplate Context="item">
            <MudStack Row="@true">
                @if (item.Value != 0)
                {
                    var pkm = Pokemon.Clone();
                    pkm.HeldItem = item.Value;
                    <MudImage Src="@SpriteHelper.GetBigItemSpriteFilename(pkm.SpriteItem)"
                              ObjectFit="@ObjectFit.Contain"
                              ObjectPosition="@ObjectPosition.Center"
                              Width="22"
                              Height="22" />
                }
                <MudText>
                    @item.Text
                </MudText>
            </MudStack>
        </ItemTemplate>
    </MudAutocomplete>

    <MudAutocomplete T="ComboItem"
                     Label="Ability"
                     Variant="@Variant.Outlined"
    @bind-Value:get="@(AppState.GetAbilityComboItem(Pokemon.Ability))"
    @bind-Value:set="@((ability) => Pokemon.Ability = ability.Value)"
                     SearchFunc="@((searchString) => Task.FromResult(AppState.SearchAbilityNames(searchString)))"
                     ToStringFunc="@((ability) => ability.Text)" />

    <MudSelect Label="Language"
               Variant="@Variant.Outlined"
    @bind-Value="@Pokemon.Language"
               For="@(() => Pokemon.Language)">
        @foreach (var language in GameInfo.FilteredSources.Languages)
        {
            <MudSelectItem Value="language.Value">
                @language.Text
            </MudSelectItem>
        }
    </MudSelect>

    <MudNumericField Label="Friendship"
                     Variant="@Variant.Outlined"
                     Min="0"
                     Max="255"
    @bind-Value="@Pokemon.CurrentFriendship"
                     For="@(() => Pokemon.CurrentFriendship)" />

    <MudStack Row="@true">

        <MudCheckBox Label="Is Egg"
        @bind-Checked="@Pokemon.IsEgg"
        @bind-Checked:after="@AppState.Refresh"
                     For="@(() => Pokemon.IsEgg)" />

        <MudCheckBox Label="Infected"
        @bind-Checked="@Pokemon.PKRS_Infected"
        @bind-Checked:after="@AppState.Refresh"
                     For="@(() => Pokemon.PKRS_Infected)" />

        <MudCheckBox Label="Cured"
        @bind-Checked="@Pokemon.PKRS_Cured"
        @bind-Checked:after="@AppState.Refresh"
                     For="@(() => Pokemon.PKRS_Cured)" />
        @*
    <MudCheckBox Label="N's Sparkle"
    @bind-Checked="@Pokemon"
    @bind-Checked:after="@AppState.Refresh"
    For="@(() => Pokemon.PKRS_Cured)" />
    *@

        <MudCheckBox Label="Shiny"
                     Checked="@Pokemon.IsShiny"
                     ReadOnly="@true"
                     For="@(() => Pokemon.IsShiny)" />

    </MudStack>
}
